<ng-container>
  <div [ngClass]="{ 'dashboard-header': isDashboardRoute, mainHeader: true }" class="header-container">
    <div class="container g-0">
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container gx-0 custom-container">
          <a class="navbar-brand m-0 p-0" routerLink="/">
            <img src="../../assets/Ximboa-Logo.png" class="ximbox-logo" alt="XIMBOA LOGO" />
          </a>
          <img src="../../assets/beta.png" class="beta-logo" alt="Beta Version" />
          <div class="category-dropdown d-none d-lg-block text-center ms-3">
            <div class="dropdown">
              <div
    class="btn dropdown-toggle bg-white p-2 px-3 d-flex align-items-center justify-content-between smallpoppins category-button"
    type="button"
    id="categoryDropdown"
    data-bs-toggle="dropdown"
    aria-expanded="false"
  >
    <span>
      <img src="../../assets/category_header_icon.png" class="category-header-logo" alt="" />
      Category
    </span>
  </div>
              <ul class="dropdown-menu">
                <li *ngFor="let category of Showcategorydata" class="dropdown-item dropdown-submenu"
                  [routerLink]="['/relevance']" [queryParams]="{ category: category.category_name, id: category._id,subcategoryId: selectedSubcategoryId}" 
                  (mouseover)="fetchSubcategories(category._id)" (mouseleave)="closeSubcategories(category._id)"
                  [queryParams]="{ category: category.category_name, id: category._id, subcategoryId: selectedSubcategoryId}">

                  <a class="dropdown-item d-flex align-items-center justify-content-between">
                    <span>
                      {{ category.category_name }}
                    </span>
                    <i class="fas fa-chevron-right"></i>
                  </a>
                  <ul class="dropdown-menu" *ngIf="hoveredCategory === category._id">
                    <li *ngFor="
                        let subcategory of subcategoriesMap[category._id] || []
                      " class="dropdown-item d-flex align-items-center justify-content-between"
                      (click)="selectSubcategory(subcategory._id, category._id)">
                      <span>
                        {{ subcategory.sub_category_name }}
                      </span>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>

          <button class="navbar-toggler d-block d-lg-none" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon px-2"></span>
          </button>
          
          <!-- Navbar Links -->
          <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
            <ul
              class="navbar-nav custom-navbar-list mb-2 mb-lg-0 gap-2 border align-items-center justify-content-center">
              <li class="nav-item text-center py-2 px-3 trainer-nav-item" routerLinkActive="active-link">
                <a class=""><span routerLink="/relevance/alltrainer" class="pointer">Trainer</span></a>
              </li>

              <li class="nav-item text-center py-2 px-3" routerLinkActive="active-link">
                <a class=""><span routerLink="/relevance/Allcourses" class="pointer">Courses</span></a>
              </li>

              <li class="nav-item text-center py-2 px-3" routerLinkActive="active-link">
                <a class=""><span routerLink="/self-evaluation" class="pointer">Self Evaluation</span></a>
              </li>

              <li class="nav-item text-center py-2 px-3" routerLinkActive="active-link" routerLink="/share-Expertise">
                <a class=""><span class="pointer">Share Expertise</span></a>
              </li>
            </ul>
          </div>

          <!-- Sign In / Sign Up (conditionally based on user login status) -->
          <div *ngIf="!(isLoggedIn$ | async)"
            class="sign-in-up ms-2 text-end d-flex gap-4 align-items-center justify-content-end">
          
            <button routerLink="/signin" class="btn btn-sm btn-login rounded-pill samllpoppins px-3 py-1" routerLinkActive="active-links">
              Log In
            </button>  

            <button routerLink="/signup" class="btn btn-sm btn-signin rounded-pill samllpoppins px-3 py-1" routerLinkActive="actives-links">
              Sign Up
            </button>
          </div>

          <div *ngIf="isLoggedIn$ | async" class="sign-in-up d-flex align-items-center justify-content-end gap-2">
            <i routerLink="/Notification" class="fa-regular fa-bell position-relative z-3 fs-4 Notification-icon"
              data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-custom-class="custom-tooltip"
              data-bs-title="Notification">
              <span *ngIf="unseennotificationcount > 0"
                class="position-absolute badge rounded-pill bg-danger notification-badge">
                {{ unseennotificationcount }}
              </span></i>
            <img routerLink="/dashboard" src="../../assets/Dashboard icon.png" class="dashboard-icon pointer" alt=""
              data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-custom-class="custom-tooltip"
              data-bs-title="Home" />
            <!-- User Profile Dropdown -->
            <div class="dropdown">
              <img *ngIf="UserImage; else noImageIcon" [src]="UserImage" data-bs-toggle="dropdown" aria-expanded="false"
                class="rounded-circle object-fit-cover user-profile-img" />
              <ng-template #noImageIcon>
                <i class="fa-solid fa-user icon" data-bs-toggle="dropdown" aria-expanded="false"></i>
              </ng-template>
              <ul class="dropdown-menu dropdown-menu-start">
                <li>
                  <a class="dropdown-item">{{ user$ | async }}</a>
                </li>

                <!-- <li>
                  <a class="dropdown-item" routerLink="/editprofilepicture">
                    Change Profile Image
                    <i class="fa-solid fa-user-pen"></i>
                  </a>
                </li> -->

                <li>
                  <a class="dropdown-item" routerLink="/profile/my-profile">Edit Profile <i
                      class="fa-solid fa-user-pen"></i></a>
                </li>
                <li>
                  <a class="dropdown-item" (click)="logout()">Logout
                    <i class="fa-solid fa-right-from-bracket pointer"></i></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>

      <nav class="navbar fixed-top d-block d-lg-none">
        <div class="container-fluid">
          <div class="offcanvas offcanvas-end custom-offcanvas" tabindex="-1" id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header mb-0 pb-0">
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link active">
                    <span routerLink="/Home" routerLinkActive="active-link" class="pointer"
                      data-bs-dismiss="offcanvas">Home</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"><span routerLink="/relevance/alltrainer" routerLinkActive="active-link"
                      class="pointer" data-bs-dismiss="offcanvas">Trainers</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"><span routerLink="/relevance/Allcourses" routerLinkActive="active-link"
                      class="pointer" data-bs-dismiss="offcanvas">Courses</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"><span routerLink="/self-evaluation" routerLinkActive="active-link" class="pointer"
                      data-bs-dismiss="offcanvas">Self Evaluation</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"><span routerLink="/share-Expertise" routerLinkActive="active-link" class="pointer"
                      data-bs-dismiss="offcanvas">Share Expertise</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"><span routerLink="/forum" routerLinkActive="active-link" class="pointer"
                      data-bs-dismiss="offcanvas">Community</span></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    </div>

    <div class="container gx-0 sticky-container">
      <div class="search-container p-1 p-md-0">
        <div class="d-flex align-items-center gap-2 gap-md-5 flex-column flex-md-row">
          <!-- Search Options -->
          <div class="mb-3 mb-md-0 ps-4 pt-2 w-25 d-none d-md-block">
            <div class="unique-animated-container">
              <p class="unique-text poppins-light mb-0">Search for</p>
              <div class="unique-box">
                <span class="word">Courses</span>
                <span class="word">Institute</span>
                <span class="word">Location</span>
                <span class="word">Instructor</span>
                <span class="word">Courses</span>
              </div>
            </div>
          </div>

          <div class="input-group location-input-group">
            <span class="input-group-text bg-white border-0 custom-icon">
              <i class="fa-solid fa-location-dot text-primary" (click)="executeLocationSearch()"></i>
            </span>
            <input type="text" class="form-control border-0 shadow-none custom-input" placeholder="Location"
              [(ngModel)]="locationQuery" (click)="fetchLocations()" (keyup)="onLocationSearch($event)" />

            <!-- Suggestions Dropdown -->
            <div *ngIf="locationSuggestions.length" class="suggestions-list">
              <div *ngFor="let group of groupedLocationResults | keyvalue">
                <ul>
                  <li *ngFor="let item of group.value" (click)="selectLocationResult($event, item)"
                    class="location-dropdown">
                    {{ item.location }}, {{ item.pincode }}
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="input-group custom-input-group">
            <span class="input-group-text bg-white border-0 custom-icon">
              <i class="fa-solid fa-magnifying-glass text-primary" (click)="onsearch()"></i>
            </span>
            <!-- <input type="text" [(ngModel)]="query" (keyup)="searchitem($event)"
              class="form-control border-0 shadow-none custom-input" placeholder="Search Course or Instructor" /> -->
              
              <!-- <input type="text" [(ngModel)]="query" (keyup)="onKeyUp($event)" (keydown.enter)="navigateBasedOnGroup('course')" class="form-control border-0 shadow-none custom-input" placeholder="Search Course or Instructor"/> -->

              <input type="text" [(ngModel)]="query" (keyup)="onKeyUp($event)" (keydown.enter)="handleEnterKey()" class="form-control border-0 shadow-none custom-input"[placeholder]="searchPlaceholder"/>

            <!-- Suggestions Dropdown -->
            <div *ngIf="suggestions.length" class="suggestions-list">
              <div *ngFor="let group of groupedSuggestions | keyvalue" >
                <h6 (click)="navigateBasedOnGroup(group.key)" class="pointer">
                  {{ group.key ? (group.key | titlecase) : "Unknown Type" }}
                  listed ({{ group.value.length }}) with {{ query }}
                </h6>
                <ul>
                  <li *ngFor="let item of group.value">
                    <a href="#" (click)="onSelectSuggestion($event, item)" class="item-name">
                      {{ item.name }}
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="ms-auto d-none d-md-block" style="height: 70px">
            <button class="menu-button" style="height: 70px">
              <i class="fa-solid fa-bars"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="exampleModalExpert" tabindex="-1" aria-labelledby="exampleModalLabel" role="dialog"
    aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content p-4">
        <div class="text-end">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form (ngSubmit)="onSubmit(form)" #form="ngForm">
          <div class="modal-body">
            <!-- Role Selection -->
            <div class="col-sm-12 col-md-6 col-lg-6">
              <label for="roleSelect">Select Role<sup>*</sup></label>
              <select class="form-select" aria-label="Default select example" [(ngModel)]="role.requested_Role"
                name="requested_Role" #roleSelect="ngModel" required>
                <option value="" disabled>Select option</option>
                <option value="SELF_EXPERT">Self Expert</option>
                <option value="INSTITUTE">Institution</option>
                <option value="TRAINER">JOIN AS INSTITUTE TRAINER</option>
              </select>
              <small *ngIf="
                  roleSelect.invalid && (roleSelect.touched || roleSelect.dirty)
                " [ngClass]="{'text-danger': roleSelect.errors?.['required']}">
                Role is required
              </small>
            </div>

            <!-- SELF_EXPERT Fields -->
            <div *ngIf="role.requested_Role === 'SELF_EXPERT'" class="row mt-3">
              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="business_Name">Business Name<sup>*</sup></label>
                <input type="text" id="business_Name" class="form-control" name="business_Name"
                  [(ngModel)]="role.business_Name" required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['business_Name']?.touched ||
                    form.controls['business_Name']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['business_Name']?.errors?.['required']">Business Name is required</small>
                </div>
              </div>
              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="whatsapp_no">Whatsapp No<sup>*</sup></label>
                <input type="text" id="whatsapp_no" class="form-control" name="whatsapp_no"
                  [(ngModel)]="role.whatsapp_no" required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['whatsapp_no']?.touched ||
                    form.controls['whatsapp_no']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['whatsapp_no']?.errors?.['required']">Whatsapp No is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="date_of_birth">Date of Birth<sup>*</sup></label>
                <input type="date" id="date_of_birth" class="form-control" name="date_of_birth"
                  [(ngModel)]="role.date_of_birth" required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['date_of_birth']?.touched ||
                    form.controls['date_of_birth']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['date_of_birth']?.errors?.['required']">Date of Birth is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="address_1">Address Line 1<sup>*</sup></label>
                <input type="text" id="address_1" class="form-control" name="address_1" [(ngModel)]="role.address_1"
                  required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['address_1']?.touched ||
                    form.controls['address_1']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['address_1']?.errors?.['required']">Address Line 1 is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="address2">Address Line 2<sup>*</sup></label>
                <input type="text" id="address2" class="form-control" name="address2" [(ngModel)]="role.address2"
                  required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['address2']?.touched ||
                    form.controls['address2']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['address2']?.errors?.['required']">Address Line 2 is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="city">City<sup>*</sup></label>
                <input type="text" id="city" class="form-control" name="city" [(ngModel)]="role.city" required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['city']?.touched ||
                    form.controls['city']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['city']?.errors?.['required']">City is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="state">State<sup>*</sup></label>
                <input type="text" id="state" class="form-control" name="state" [(ngModel)]="role.state" required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['state']?.touched ||
                    form.controls['state']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['state']?.errors?.['required']">State is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="country">Country<sup>*</sup></label>
                <input type="text" id="country" class="form-control" name="country" [(ngModel)]="role.country"
                  required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['country']?.touched ||
                    form.controls['country']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['country']?.errors?.['required']">Country is required</small>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6 form-group mb-2">
                <label for="pincode">Pincode<sup>*</sup></label>
                <input type="text" id="pincode" class="form-control" name="pincode" [(ngModel)]="role.pincode"
                  required />
                <div *ngIf="
                    form.submitted ||
                    form.controls['pincode']?.touched ||
                    form.controls['pincode']?.dirty
                  " class="text-danger">
                  <small *ngIf="form.controls['pincode']?.errors?.['required']">Pincode is required</small>
                </div>
              </div>
            </div>

            <!-- INSTITUTE Fields -->
            <div *ngIf="role.requested_Role === 'INSTITUTE'" class="row mt-3">
              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="business_Name">INSTITUTE Name<sup>*</sup></label>
                  <input type="text" id="business_Name" class="form-control" name="business_Name"
                    [(ngModel)]="institute.business_Name" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['business_Name']?.touched ||
                      form.controls['business_Name']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['business_Name']?.errors?.['required']">Institute Name is
                      required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="mobile_number">Mobile No<sup>*</sup></label>
                  <input type="text" id="mobile_number" class="form-control" name="mobile_number"
                    [(ngModel)]="institute.mobile_number" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['mobile_number']?.touched ||
                      form.controls['mobile_number']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['mobile_number']?.errors?.['required']">Mobile No is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="whatsapp_no">Whatsapp No<sup>*</sup></label>
                  <input type="text" id="whatsapp_no" class="form-control" name="whatsapp_no"
                    [(ngModel)]="institute.whatsapp_no" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['whatsapp_no']?.touched ||
                      form.controls['whatsapp_no']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['whatsapp_no']?.errors?.['required']">Whatsapp No is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="date_of_birth">Date of Birth<sup>*</sup></label>
                  <input type="date" id="date_of_birth" class="form-control" name="date_of_birth"
                    [(ngModel)]="institute.date_of_birth" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['date_of_birth']?.touched ||
                      form.controls['date_of_birth']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['date_of_birth']?.errors?.['required']">Date of Birth is
                      required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="address_1">Address Line 1<sup>*</sup></label>
                  <input type="text" id="address_1" class="form-control" name="address_1"
                    [(ngModel)]="institute.address_1" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['address_1']?.touched ||
                      form.controls['address_1']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['address_1']?.errors?.['required']">Address Line 1 is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="address2">Address Line 2<sup>*</sup></label>
                  <input type="text" id="address2" class="form-control" name="address2" [(ngModel)]="institute.address2"
                    required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['address2']?.touched ||
                      form.controls['address2']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['address2']?.errors?.['required']">Address Line 2 is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="city">City<sup>*</sup></label>
                  <input type="text" id="city" class="form-control" name="city" [(ngModel)]="institute.city" required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['city']?.touched ||
                      form.controls['city']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['city']?.errors?.['required']">City is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="state">State<sup>*</sup></label>
                  <input type="text" id="state" class="form-control" name="state" [(ngModel)]="institute.state"
                    required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['state']?.touched ||
                      form.controls['state']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['state']?.errors?.['required']">State is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="country">Country<sup>*</sup></label>
                  <input type="text" id="country" class="form-control" name="country" [(ngModel)]="institute.country"
                    required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['country']?.touched ||
                      form.controls['country']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['country']?.errors?.['required']">Country is required</small>
                  </div>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="form-group mb-2">
                  <label for="pincode">Pincode<sup>*</sup></label>
                  <input type="text" id="pincode" class="form-control" name="pincode" [(ngModel)]="institute.pincode"
                    required />
                  <div *ngIf="
                      form.submitted ||
                      form.controls['pincode']?.touched ||
                      form.controls['pincode']?.dirty
                    " class="text-danger">
                    <small *ngIf="form.controls['pincode']?.errors?.['required']">Pincode is required</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- TRAINER Fields -->
            <div *ngIf="role.requested_Role === 'TRAINER'" class="mt-3">
              <label for="roleSelect">Select Institute<sup>*</sup></label>
              <select class="form-select" aria-label="Default select example"
                [(ngModel)]="TrainerundersInstitute.instituteId" name="instituteId" required>
                <option value="" disabled>Select Institute</option>
                <option *ngFor="let institute of Institutedata" value="{{ institute._id }}">
                  {{ institute.institute_name }}
                </option>
              </select>
              <div *ngIf="
                  form.submitted ||
                  form.controls['instituteId']?.touched ||
                  form.controls['instituteId']?.dirty
                " class="text-danger">
                <small *ngIf="form.controls['instituteId']?.errors?.['required']">Institute selection is
                  required</small>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-center justify-content-end gap-4 mt-5">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-container>