<mat-card class="custom-mat-card" style="background-color: rgb(255,255,255);">
  <div>
    <div class="block">
      <h5 class="enquiry-heading">Enquiry</h5>
    </div>

    <!-- Header Section -->
    <div class="p-5 pb-0 bg-gray-100 rounded-lg container">
      <div class="flex justify-between items-center custom-flex-nowrap">
        <div class="inquiry-messages">
          <p class="text-sm text-gray-500">You've got {{ getInquiryCount() }} Messages</p>
        </div>

        <div class="flex space-x-2 btn-group" mat-button-toggle-group>
          <button id="allBtn" class="p-2 text-white bg-blue-600 rounded-lg all-btn"
            (click)="loadAllEnquiry(currentPage, itemsPerPage)">
            All
          </button>
          <button id="unreadBtn" class="p-2 text-gray-700 bg-white border rounded-lg unread-btn"
            (click)="showUnreadinquiry()">
            Unread ({{ getUnseenCount() }})
          </button>
          <button id="markCompletedBtn" class="p-2 text-white bg-blue-600 rounded-l mark-completed-btn"
            (click)="markAllAsCompleted()">
            Mark all as completed
          </button>
        </div>
      </div>
    </div>

    <!-- <h3 class="text-lg font-semibold text-gray-800 mb-4">{{ showEnquiryData[0].createdAt | date }}</h3> -->

    <!-- Questions List Using Angular Material Accordion -->
   
    <div style="padding: 10px 30px;">
      <mat-accordion style="background-color: EDF1F9;"
      *ngFor="let inquiry of showEnquiryData |  paginate:{ itemsPerPage: itemsPerPage, currentPage: p, totalItems } ">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">
        {{ showEnquiryData.createdAt | date }}
      </h3>

      <mat-expansion-panel *ngIf="inquiry._id" [ngClass]="{ 'selected-inquiry': inquiry.isSelected }"
        (opened)="markseenbyid(inquiry._id)" class="clickable-panel">
        <mat-expansion-panel-header class="question-card" style="background-color: rgb(255,255,255); box-shadow: none;">
          <img class="profile-img" [src]="inquiry.profile_image" alt="Profile Image">

          <div class="user-info">
            <h3 [ngClass]="{'text-muted': inquiry.isSeen, 'fw-bold': !inquiry.isSeen}" class="inquiry-username">
              {{ inquiry.user_name }}
            </h3>

            <p [ngClass]="{'text-muted': inquiry.isSeen, 'text-dark fw-bold': !inquiry.isSeen}" class="email-text">
              {{ inquiry.email_id }}
            </p>
          </div>

          <div class="action-buttons">
            <span>
              {{ inquiry.time}}
            </span>
            <span class="ml-5 delete-icon" style="margin-left: 1.5rem !important; color: red;" (click)="onDelete(inquiry._id); $event.stopPropagation();"> 
              <mat-icon>delete</mat-icon>
            </span>
          </div>
        </mat-expansion-panel-header>

        <div class="user-info">
          <p><strong>Name:</strong> {{ inquiry.user_name }}</p>
          <p><strong>Email:</strong> {{ inquiry.email_id }}</p>
          <p><strong>Mobile No:</strong> {{ inquiry.mobile_number }}</p>
          <div class="question-text"><strong>Description:</strong> {{ inquiry.description }}</div>
        </div>

        <!-- Mark as Seen -->
        <!-- <button *ngIf="!question.isSeen" class="mark-seen-button" (click)="markSeenById(question)">
          <i class="fa-solid fa-eye"></i> Mark as Seen
        </button> -->

        <!-- Reply Section -->
        <button class="reply-button" (click)="toggleReply(inquiry)">
          <i class="fa-solid fa-reply reply-icon"></i>
          Reply
        </button>

        <div *ngIf="inquiry.showReplyBox" class="d-flex gap-3">
          <textarea [(ngModel)]="inquiry.replyText" placeholder="Type your reply..."></textarea>
          <button (click)="sendReply(inquiry)" class="btn-reply">
            <i class="fa-solid fa-paper-plane"></i>
            Send
          </button>
        </div>

        <!-- Replies Section -->
        <div *ngIf="inquiry.replies?.length > 0" class="replies-container">
          <h4 class="replies-title">Replies</h4>
          <div *ngFor="let reply of inquiry.replies" class="reply-card">
            <div class="reply-header">
              <img [src]="reply.profile_image" alt="Profile" class="reply-profile-img">
              <div class="reply-info">
                <p class="reply-username">{{ reply.user_name }}</p>
                <p class="reply-date">{{ reply.createdAt | date}}{{reply.time}}</p>
              </div>
            </div>
            <p class="reply-text">{{ reply.reply }}</p>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    </div>
    <pagination-controls (pageChange)="onPageChange($event)" class="text-end small-font"></pagination-controls>

  </div>
</mat-card>